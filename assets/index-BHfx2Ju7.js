(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function a(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function n(o){if(o.ep)return;o.ep=!0;const e=a(o);fetch(o.href,e)}})();async function le(t){if(t.length===0)return"";const s=new Blob([t]).stream().pipeThrough(new CompressionStream("gzip")),a=new Uint8Array(await new Response(s).arrayBuffer()),n=Array.from(a,o=>String.fromCodePoint(o)).join("");return btoa(n)}async function de(t){if(t.length===0)return"";const s=atob(t),a=Uint8Array.from(s,n=>n.charCodeAt(0));try{const n=new Blob([a]).stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(n).text()}catch{return new TextDecoder().decode(a)}}function I(t){return t.replace(/\r\n?/g,`
`)}async function B(t){const s=new TextEncoder().encode(I(t)),a=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(a),n=>n.toString(16).padStart(2,"0")).join("")}const F="#doc=";async function ue(){const t=window.location.hash,s=t.startsWith(F),a=s?await ge(t.substring(F.length)):null;if(me(),a){const u=I(a.content||""),d=await B(u),h=a.parent??d;return localStorage.setItem("doc",JSON.stringify({content:u,parent:d})),localStorage.setItem("originalParent",h),{content:u,sessionParent:d,originalParent:h,isSharedLink:s}}const n=xe(),o=I(n?.content||""),e=n?.parent??await B(o),r=W();return localStorage.setItem("doc",JSON.stringify({content:o,parent:e})),{content:o,sessionParent:e,originalParent:r,isSharedLink:s}}async function pe(t,s){t===""?(localStorage.setItem("doc",JSON.stringify({content:"",parent:await B("")})),localStorage.removeItem("originalParent")):localStorage.setItem("doc",JSON.stringify({content:t,parent:s}))}function W(){return localStorage.getItem("originalParent")}function fe(){try{const t=localStorage.getItem("caretPosition");return t!==null?parseInt(t,10):0}catch{return 0}}function he(t){localStorage.setItem("caretPosition",String(t))}function me(){window.history.replaceState(null,"",window.location.pathname)}async function ge(t){try{const s=decodeURIComponent(t);if(s.startsWith("https://")||s.startsWith("http://"))return await ye(s);const a=await de(s);return JSON.parse(a)}catch(s){return console.error("Error loading document from URL:",s.message),null}}async function ye(t){const s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch document: ${s.status} ${s.statusText}`);const a=await s.text();try{const n=JSON.parse(a);if(n.content!==void 0)return n}catch{}return{content:a}}function xe(){const t=localStorage.getItem("doc");if(!t)return null;try{return JSON.parse(t)}catch(s){return console.error("Error parsing saved doc",s),null}}const M=2,$e=/^(\s*(?:>\s*)*)([-*+] (?:\[[ xX]\] )?|\d+\. )?/;function D(t,s){let a=s;for(;a>0&&t[a-1]!==`
`;)a--;return a}function H(t,s){let a=s;for(;a<t.length&&t[a]!==`
`;)a++;return a}function J(t){const s=t.match($e),a=s[1]||"",n=s[2]||"";return{prefix:a+n,structural:a,marker:n}}function we(t,s,a){if(!a.match(/^[-=]+\s*$/)||s===0)return!1;const n=D(t,s-1),o=t.slice(n,s-1);if(o===""||o.match(/^\s*(---+|\*\*\*+|___+)\s*$/)||o.match(/^- /))return!1;if(n>0){const e=D(t,n-1);if(t.slice(e,n-1)!=="")return!1}return!0}function be(t,s){if(!s)return t;const a=s.match(/^([-*+] )\[[ xX]\] $/);if(a)return t+a[1]+"[ ] ";const n=s.match(/^(\d+)\. $/);if(n){const o=parseInt(n[1],10)+1;return t+o+". "}return t+s}function ve(t,s,a){const n=D(t,s),o=H(t,a),e=t.slice(n,o);if(we(t,n,e))return{text:t.slice(0,s)+`
`+t.slice(a),offset:s+1};const{prefix:r,structural:u,marker:d}=J(e);if(r.length===0)return{text:t.slice(0,s)+`
`+t.slice(a),offset:s+1};const h=e.slice(r.length),x=s<=n+r.length;if(h.trim()===""&&x)return{text:t.slice(0,n)+t.slice(n+r.length),offset:n};const y=be(u,d);return{text:t.slice(0,s)+`
`+y+t.slice(a),offset:s+1+y.length}}function Se(t,s){const a=D(t,s),n=t.slice(a,H(t,s)),{prefix:o}=J(n),e=s-a,r=" ".repeat(M);return e<=o.length?{text:t.slice(0,a)+r+t.slice(a),offset:s+M}:{text:t.slice(0,s)+r+t.slice(s),offset:s+M}}function Te(t,s){const a=D(t,s),o=t.slice(a,H(t,s)).match(/^\s*/)[0].length,e=Math.min(o,M);if(e===0)return{text:t,offset:s};const r=t.slice(0,a)+t.slice(a+e),u=Math.max(a,s-e);return{text:r,offset:u}}function Le(t,s,a,n,o={}){let e=s;const r=[],u=[];let d=0,h="",x=-1,$=!1,y=-1;function w(i){t.innerHTML=a(i)}function b(i,c,l){if(c===i){let m=0;const _=Math.min(l,i.childNodes.length);for(let C=0;C<_;C++)m+=i.childNodes[C].textContent.length,C<i.childNodes.length-1&&(m+=1);return m}let f=c;for(;f&&f.parentNode!==i;)f=f.parentNode;if(!f)return 0;let g=0;for(let m=i.firstChild;m&&m!==f;m=m.nextSibling)g+=m.textContent.length+1;try{const m=document.createRange();m.setStart(f,0),m.setEnd(c,l),g+=m.toString().length}catch{}return g}function k(){const i=window.getSelection();return i.rangeCount?b(t,i.focusNode,i.focusOffset):0}function L(){const i=window.getSelection();if(!i.rangeCount)return{start:0,end:0};const c=b(t,i.anchorNode,i.anchorOffset),l=b(t,i.focusNode,i.focusOffset);return{start:Math.min(c,l),end:Math.max(c,l)}}function E(i){const c=document.createTreeWalker(i,NodeFilter.SHOW_TEXT);let l=null;for(;c.nextNode();)l=c.currentNode;return l}function P(i,c){const l=E(c);l?i.collapse(l,l.textContent.length):i.collapse(c,c.childNodes.length)}function O(i){const c=window.getSelection(),l=Array.from(t.children);if(l.length===0){c.collapse(t,0);return}let f=i;for(let g=0;g<l.length;g++){const m=l[g],_=m.textContent.length;if(f<=_){const C=document.createTreeWalker(m,NodeFilter.SHOW_TEXT);for(;C.nextNode();){const q=C.currentNode.textContent.length;if(f<=q){c.collapse(C.currentNode,f);return}f-=q}c.collapse(m,0);return}if(f-=_,g<l.length-1){if(f===0){P(c,m);return}f-=1}}P(c,l[l.length-1])}function j(){const i=window.getSelection();if(!i.rangeCount)return;let c=i.getRangeAt(0).getBoundingClientRect();if(c.top===0&&c.bottom===0&&c.left===0&&c.right===0){const g=i.focusNode,m=g?.nodeType===Node.ELEMENT_NODE?g:g?.parentElement;m&&(c=m.getBoundingClientRect())}if(!c||c.top===0&&c.bottom===0)return;const l=40,f=window.innerHeight;c.bottom>f-l?window.scrollBy({top:c.bottom-f+l,behavior:"smooth"}):c.top<l&&window.scrollBy({top:c.top-l,behavior:"smooth"})}function v(i,c){const l=Date.now(),f=Math.abs(c-x)>1;if(i===h&&!f&&l-d<500&&r.length>0){d=l,x=c;return}r.push({text:e,offset:c}),u.length=0,d=l,h=i,x=c}function V(){if(r.length===0)return;u.push({text:e,offset:k()});const i=r.pop();e=i.text,w(e),O(i.offset),j(),n(e)}function G(){if(u.length===0)return;r.push({text:e,offset:k()});const i=u.pop();e=i.text,w(e),O(i.offset),j(),n(e)}function Q(i){if(i===0)return 0;let c=i;for(;c>0&&/\s/.test(e[c-1]);)c--;if(c===0)return 0;if(/\w/.test(e[c-1]))for(;c>0&&/\w/.test(e[c-1]);)c--;else for(;c>0&&!/[\s\w]/.test(e[c-1]);)c--;return c}function Y(i){const c=e.length;if(i>=c)return c;let l=i;if(/\w/.test(e[l]))for(;l<c&&/\w/.test(e[l]);)l++;else if(/\s/.test(e[l]))for(;l<c&&/\s/.test(e[l]);)l++;else for(;l<c&&!/[\s\w]/.test(e[l]);)l++;for(;l<c&&/\s/.test(e[l]);)l++;return l}function ee(i){if(i===0)return 0;let c=i;for(;c>0&&e[c-1]!==`
`;)c--;return c}function te(i){const c=e.length;if(i>=c)return c;let l=i;for(;l<c&&e[l]!==`
`;)l++;return l}function R(i){const c=i.length,{start:l,end:f}=L();if(!(l!==f)){v("format",l),e=e.slice(0,l)+i+i+e.slice(l),S(l+c);return}const m=e.slice(l-c,l),_=e.slice(f,f+c);m===i&&_===i?(v("format",l),e=e.slice(0,l-c)+e.slice(l,f)+e.slice(f+c),S(f-c)):(v("format",l),e=e.slice(0,l)+i+e.slice(l,f)+i+e.slice(f),S(f+c+c))}function S(i){w(e),O(i),j(),n(e),o.onCaretChange?.(i)}function N(i,c,l,f){if(c!==l)v(i,c),e=e.slice(0,c)+e.slice(l),S(c);else{const g=f();if(g!==c){v(i,c);const m=Math.min(c,g),_=Math.max(c,g);e=e.slice(0,m)+e.slice(_),S(m)}}}function ne(i){if($||(i.preventDefault(),i.inputType==="insertCompositionText")||i.inputType==="insertFromPaste"||i.inputType==="deleteByCut")return;const{start:c,end:l}=L();switch(i.inputType){case"insertText":{const f=i.data||"";v("insertText",c),e=e.slice(0,c)+f+e.slice(l),S(c+f.length);break}case"insertParagraph":case"insertLineBreak":{v("insertLine",c);const f=ve(e,c,l);e=f.text,S(f.offset);break}case"deleteContentBackward":N("delete",c,l,()=>Math.max(0,c-1));break;case"deleteContentForward":N("delete",c,l,()=>Math.min(e.length,c+1));break;case"deleteWordBackward":N("deleteWord",c,l,()=>Q(c));break;case"deleteWordForward":N("deleteWord",c,l,()=>Y(c));break;case"deleteSoftLineBackward":case"deleteHardLineBackward":N("deleteLine",c,l,()=>ee(c));break;case"deleteSoftLineForward":case"deleteHardLineForward":N("deleteLine",c,l,()=>te(c));break;case"insertReplacementText":{const f=i.getTargetRanges();if(f.length>0){const g=f[0],m=b(t,g.startContainer,g.startOffset),_=b(t,g.endContainer,g.endOffset),C=i.dataTransfer?.getData("text/plain")||i.data||"";v("replace",m),e=e.slice(0,m)+C+e.slice(_),S(m+C.length)}break}}}function se(){$=!0,y=k()}function oe(){$=!1;const i=k();v("composition",y>=0?y:i),y=-1,e=Array.from(t.children).map(c=>c.textContent).join(`
`),w(e),O(i),n(e)}function ce(i){i.preventDefault();const{start:c,end:l}=L();c!==l&&i.clipboardData.setData("text/plain",e.slice(c,l))}function re(i){i.preventDefault();const{start:c,end:l}=L();c!==l&&(i.clipboardData.setData("text/plain",e.slice(c,l)),v("cut",c),e=e.slice(0,c)+e.slice(l),S(c))}function ae(i){i.preventDefault();const c=I(i.clipboardData.getData("text/plain"));if(!c)return;const{start:l,end:f}=L();v("paste",l),e=e.slice(0,l)+c+e.slice(f),S(l+c.length)}function ie(i){if((i.metaKey||i.ctrlKey)&&i.key==="z"?(i.preventDefault(),i.shiftKey?G():V()):(i.metaKey||i.ctrlKey)&&i.key==="b"?(i.preventDefault(),R("**")):(i.metaKey||i.ctrlKey)&&i.key==="i"&&(i.preventDefault(),R("_")),i.key==="Tab"){i.preventDefault();const{start:c,end:l}=L(),f=c!==l;if(i.shiftKey){v("outdent",c);const g=Te(e,c);e=g.text,S(g.offset)}else if(f)v("indent",c),e=e.slice(0,c)+"  "+e.slice(l),S(c+2);else{v("indent",c);const g=Se(e,c);e=g.text,S(g.offset)}}}t.addEventListener("keydown",ie),t.addEventListener("beforeinput",ne),t.addEventListener("compositionstart",se),t.addEventListener("compositionend",oe),t.addEventListener("copy",ce),t.addEventListener("cut",re),t.addEventListener("paste",ae),t.addEventListener("blur",()=>{$=!1}),w(e);const A=Math.min(o.initialCaretPosition??0,e.length);if(A>0){O(A);const i=window.getSelection();if(i.rangeCount){const c=i.getRangeAt(0).getBoundingClientRect();if(c&&c.height>0){const l=window.innerHeight/2;window.scrollBy({top:c.top-l})}}}return document.addEventListener("selectionchange",()=>{if(!o.onCaretChange)return;const i=window.getSelection();i.rangeCount&&t.contains(i.focusNode)&&o.onCaretChange(k())}),{getText:()=>e}}function p(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Ce(t){const s={},a=t.split(`
`);for(const n of a){const o=n.match(/^\[([^\]]+)\]:\s+(\S+)(?:\s+"([^"]*)")?$/);o&&(s[o[1].toLowerCase()]={url:o[2],title:o[3]||""})}return s}function _e(t){const s={},a=t.split(`
`);for(const n of a){const o=n.match(/^\[\^([^\]]+)\]:\s+(.*)/);o&&(s[o[1].toLowerCase()]=o[2])}return s}function X(t){const s=t.split(`
`),a=[];let n=0,o=0;if(s[0].match(/^---\s*$/)&&s.length>1){for(let e=1;e<s.length;e++)if(s[e].match(/^\s*---\s*$/)){const r=s.slice(0,e+1).join(`
`);a.push({type:"metadata",text:r,offset:0}),n=r.length+1,o=e+1;break}}for(;o<s.length;){const e=s[o];if(e.match(/^```/)){let r=o+1;for(;r<s.length&&!s[r].match(/^\s*```/);)r++;if(r<s.length){const u=s.slice(o,r+1).join(`
`);a.push({type:"code",text:u,offset:n}),n+=u.length+1,o=r+1;continue}}if(e.match(/^\$\$\s*$/)){let r=o+1;for(;r<s.length&&!s[r].match(/^\s*\$\$/);)r++;if(r<s.length){const u=s.slice(o,r+1).join(`
`);a.push({type:"math",text:u,offset:n}),n+=u.length+1,o=r+1;continue}}if(e.match(/^\|.*\|\s*$/)&&o+1<s.length){const r=s[o+1];if(r.match(/^\|(?:\s*:?-+:?\s*\|)+\s*$/)){const u=d=>d.split("|").length-1;if(u(e)===u(r)){let d=o+2;for(;d<s.length&&s[d].match(/^\|.*\|\s*$/);)d++;const h=s.slice(o,d).join(`
`);a.push({type:"table",text:h,offset:n}),n+=h.length+1,o=d;continue}}}if(e.match(/^\s*>(?:\s|$)/)){let r=o+1;for(;r<s.length&&s[r].match(/^\s*>(?:\s|$)/);)r++;const d=s.slice(o,r).map(y=>{const w=y.match(/^(\s*>)(\s?)(.*)/);return w?{prefix:w[1]+w[2],content:w[3]}:{prefix:"",content:y}}),h=d.map(y=>y.content).join(`
`),x=X(h);let $=0;for(const y of x){const w=y.text.split(`
`).length,b=d.slice($,$+w).map(E=>E.prefix),L=y.text.split(`
`).map((E,P)=>b[P]+E).join(`
`);y.blockquote?a.push({type:y.type,text:L,offset:n,blockquote:!0,innerText:y.innerText,prefixes:b.map((E,P)=>E+y.prefixes[P])}):a.push({type:y.type,text:L,offset:n,blockquote:!0,innerText:y.text,prefixes:b}),n+=L.length+1,$+=w}o=r;continue}if(e.match(/^#{1,6}[ \t]+.+$/)){a.push({type:"heading",text:e,offset:n}),n+=e.length+1,o++;continue}if(e!==""&&!e.match(/^\s*(---+|\*\*\*+|___+)\s*$/)&&!e.match(/^- /)&&(o===0||s[o-1]==="")&&o+1<s.length){const r=s[o+1];if(r.match(/^=+\s*$/)||r.match(/^-+\s*$/)){const u=e+`
`+r;a.push({type:"setext",text:u,offset:n}),n+=u.length+1,o+=2;continue}}if(e.match(/^\s*(---+|\*\*\*+|___+)\s*$/)){a.push({type:"hr",text:e,offset:n}),n+=e.length+1,o++;continue}if(e.match(/^(?: {4}|\t)/)&&!e.match(/^\s*[*\-+] /)&&!e.match(/^\s*\d+\. /)&&!e.match(/^\s*>(?:\s|$)/)){let r=o+1;for(;r<s.length&&s[r].match(/^(?: {4}|\t)/)&&!s[r].match(/^\s*[*\-+] /)&&!s[r].match(/^\s*\d+\. /)&&!s[r].match(/^\s*>(?:\s|$)/);)r++;const u=s.slice(o,r).join(`
`);a.push({type:"indented-code",text:u,offset:n}),n+=u.length+1,o=r;continue}if(e.match(/^\s*[*\-+] /)||e.match(/^\s*\d+\. /)||e.match(/^: /)){let r=o+1;for(;r<s.length&&(s[r].match(/^\s*[*\-+] /)||s[r].match(/^\s*\d+\. /)||s[r].match(/^: /));)r++;const u=s.slice(o,r).join(`
`);a.push({type:"list",text:u,offset:n}),n+=u.length+1,o=r;continue}a.push({type:"line",text:e,offset:n}),n+=e.length+1,o++}return a}function T(t,s,a){let n=t;const o=[],e=u=>{const d=`PROTECTED${o.length}`;return o.push(u),d};n=n.replace(/\\([\\`*_{}\[\]()#+\-.!~^|$])/g,(u,d)=>e(`<span class="md-syntax">\\</span>${p(d)}`)),n=n.replace(new RegExp("(?<!`)`(?!`)([^`\\n]+?)`(?!`)","g"),(u,d)=>e(`<code><span class="md-syntax">\`</span>${p(d)}<span class="md-syntax">\`</span></code>`)),n=n.replace(new RegExp("(?<!\\$)\\$(?!\\$)([^\\$\\n]+?)\\$(?!\\$)","g"),(u,d)=>e(`<code class="math"><span class="md-syntax">$</span>${p(d)}<span class="md-syntax">$</span></code>`)),n=n.replace(/<!--([\s\S]*?)-->/g,(u,d)=>e(`<span class="comment">&lt;!--${p(d)}--&gt;</span>`)),n=n.replace(/<(https?:\/\/[^>\s]+)>/g,(u,d)=>e(`<span class="md-syntax">&lt;</span><a href="${p(d)}" target="_blank" rel="noopener noreferrer">${p(d)}</a><span class="md-syntax">&gt;</span>`)),n=n.replace(/<([^>\s]+@[^>\s]+\.[^>\s]+)>/g,(u,d)=>e(`<span class="md-syntax">&lt;</span><a href="mailto:${p(d)}">${p(d)}</a><span class="md-syntax">&gt;</span>`)),n=n.replace(/<\/?[a-zA-Z][a-zA-Z0-9-]*(?:[ \t]+[^>]*)?\/?>/g,u=>e(`<code class="md-syntax">${p(u)}</code>`)),n=n.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(u,d,h)=>e(`<span class="md-syntax">![</span>${p(d)}<span class="md-syntax">](</span><a href="${p(h)}" target="_blank" rel="noopener noreferrer">${p(h)}</a><span class="md-syntax">)</span>`)),n=n.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(u,d,h)=>e('<span class="md-syntax">[</span>')+d+e(`<span class="md-syntax">](</span><a href="${p(h)}" target="_blank" rel="noopener noreferrer">${p(h)}</a><span class="md-syntax">)</span>`)),n=n.replace(/!\[([^\]]*)\]\[([^\]]*)\]/g,(u,d,h)=>{const x=(h||d).toLowerCase(),$=s[x];return $?e(`<span class="md-syntax">![</span>${p(d)}<span class="md-syntax">][</span><a href="${p($.url)}" target="_blank" rel="noopener noreferrer">${p(h)}</a><span class="md-syntax">]</span>`):u}),n=n.replace(/\[([^\]]+)\]\[([^\]]*)\]/g,(u,d,h)=>{const x=(h||d).toLowerCase(),$=s[x];return $?e('<span class="md-syntax">[</span>')+d+e(`<span class="md-syntax">][</span><a href="${p($.url)}" target="_blank" rel="noopener noreferrer">${p(h)}</a><span class="md-syntax">]</span>`):u}),n=n.replace(/\[\^([^\]]+)\]/g,(u,d)=>{const h=a[d.toLowerCase()];return h?e('<span class="md-syntax">[^</span>')+e(`<a title="${p(h)}">${p(d)}</a>`)+e('<span class="md-syntax">]</span>'):e('<span class="md-syntax">[^</span>')+d+e('<span class="md-syntax">]</span>')}),n=p(n);const r=u=>`<span class="md-syntax">${u}</span>`;return n=n.replace(/\*\*\*([^\s\*](?:[^\*\n]*?[^\s\*])?)\*\*\*/g,(u,d)=>e(`<b><em>${r("***")}`)+d+e(`${r("***")}</em></b>`)),n=n.replace(/\*\*([^\s\*](?:[^\*\n]*?[^\s\*])?)\*\*/g,(u,d)=>`<b>${r("**")}${d}${r("**")}</b>`),n=n.replace(/__([^\s_](?:[^_\n]*?[^\s_])?)__/g,(u,d)=>`<b>${r("__")}${d}${r("__")}</b>`),n=n.replace(/~~([^\s~](?:[^~\n]*?[^\s~])?)~~/g,(u,d)=>`<s>${r("~~")}${d}${r("~~")}</s>`),n=n.replace(/\^([^\s^](?:[^^\n]*?[^\s^])?)\^/g,(u,d)=>`<sup>${r("^")}${d}${r("^")}</sup>`),n=n.replace(new RegExp("(?<!~)~(?!~)([^\\s~](?:[^~\\n]*?[^\\s~])?)~(?!~)","g"),(u,d)=>`<sub>${r("~")}${d}${r("~")}</sub>`),n=n.replace(new RegExp("(?<!\\*)\\*(?!\\*)([^\\s\\*](?:[^\\*\\n]*?[^\\s\\*])?)\\*(?!\\*)","g"),(u,d)=>`<em>${r("*")}${d}${r("*")}</em>`),n=n.replace(/_([^\s_](?:[^_\n]*?[^\s_])?)_/g,(u,d)=>`<em>${r("_")}${d}${r("_")}</em>`),n=n.replace(/\uE000PROTECTED(\d+)\uE001/g,(u,d)=>o[parseInt(d,10)]),n}function ke(t){let s="",a=t;for(;a.length>0;){const n=a.match(/^(\s*)(>)(\s?)/);if(!n){s+=p(a);break}const o=n[1],e=n[2],r=n[3];o&&(s+=`<span class="indent">${p(o)}</span>`),s+=`<span class="md-syntax bq-prefix">${p(e)}${r}</span>`,a=a.slice(n[0].length)}return s}function Ee(t){return/^<\w+[^>]*\sclass="[^"]*bq/.test(t)?t:/^<\w+[^>]*\sclass="/.test(t)?t.replace(/^(<\w+[^>]*\sclass="[^"]*)(")/,"$1 bq$2"):t.replace(/^(<\w+)/,'$1 class="bq"')}function Pe(t,s){const n=t.split(`
`).map((o,e)=>{const r=s[e];if(!r)return o;const u=ke(r),d=o.match(/^(<(?:pre|code|div|h[1-6])[^>]*>)*/),h=d?d[0].length:0,x=o.replace(/<br>/g,"");return x.slice(0,h)+u+x.slice(h)}).join(`
`);return Ee(n)}function K(t,s,a){const n=a?` class="${a}"`:"",o=t.match(s);return o?`<pre><code${n}><span class="md-syntax">${p(o[1])}</span>
${p(o[2])}
<span class="md-syntax">${p(o[3])}</span></code></pre>`:`<pre><code${n}>${p(t)}</code></pre>`}function z(t,s,a){if(t.blockquote){const n={type:t.type,text:t.innerText},o=z(n,s,a);let e=0;const r=[];for(const u of o){const d=(u.match(/\n/g)||[]).length+1,h=t.prefixes.slice(e,e+d);r.push(Pe(u,h)),e+=d}return r}switch(t.type){case"metadata":{const n=t.text.split(`
`),o=`<span class="md-syntax">${p(n[0])}</span>`,e=`<span class="md-syntax">${p(n[n.length-1])}</span>`,r=n.slice(1,-1);return r.length>0?[`<pre><code>${o}
${r.map(u=>p(u)).join(`
`)}
${e}</code></pre>`]:[`<pre><code>${o}
${e}</code></pre>`]}case"code":return[K(t.text,/^(```[^\n]*)\n([\s\S]*?)\n(\s*```)$/)];case"indented-code":return[`<pre><code>${p(t.text)}</code></pre>`];case"table":return[`<pre><code>${t.text.split(`
`).map((e,r)=>{const u=p(e);return r===1?`<span class="md-syntax">${u}</span>`:u.replace(/\|/g,'<span class="md-syntax">|</span>')}).join(`
`)}</code></pre>`];case"math":return[K(t.text,/^(\$\$)\n([\s\S]*?)\n(\s*\$\$)$/,"math")];case"heading":{const n=t.text.match(/^(#{1,6}[ \t]+)(.*)/),o=n[1].trim().length;return[`<h${o}><span class="md-syntax">${p(n[1])}</span>${T(n[2],s,a)}</h${o}>`]}case"setext":{const n=t.text.indexOf(`
`),o=t.text.slice(0,n),e=t.text.slice(n+1),r=e.trimStart()[0]==="="?1:2;return[`<h${r}>${T(o,s,a)}
<span class="md-rule md-syntax">${p(e)}</span></h${r}>`]}case"hr":return[`<div class="md-rule md-syntax">${p(t.text)}</div>`];case"list":return[`<div class="list">${t.text.split(`
`).map(e=>{const r=e.match(/^(\s*)([*\-+] )/);if(r){const h=r[1],x=r[2],$=e.slice(h.length+x.length),y=h?`<span class="indent">${p(h)}</span>`:"",w=$.match(/^(\[[ xX]\] )/);if(w){const b=w[1],k=$.slice(b.length),E=b[1]!==" "?`<span class="task-done">${T(k,s,a)}</span>`:T(k,s,a);return`${y}<span class="md-syntax">${p(x)}</span><span class="md-checkbox">${p(b)}</span>${E}`}return`${y}<span class="md-syntax">${p(x)}</span>${T($,s,a)}`}const u=e.match(/^(\s*)(\d+\. )/);if(u){const h=u[1],x=u[2],$=e.slice(h.length+x.length);return`${h?`<span class="indent">${p(h)}</span>`:""}<span class="md-syntax">${p(x)}</span>${T($,s,a)}`}const d=e.match(/^(: )/);if(d){const h=d[1],x=e.slice(h.length);return`<span class="md-syntax">${p(h)}</span>${T(x,s,a)}`}return T(e,s,a)}).join(`
`)}</div>`];case"line":{if(t.text==="")return['<div class="line"><br></div>'];const n=t.text.match(/^(\*\[)([^\]]+)(\]:\s)(.*)/)||t.text.match(/^(\[\^)([^\]]+)(\]:\s)(.*)/);if(n)return[`<div class="line"><span class="md-syntax">${p(n[1])}</span>${p(n[2])}<span class="md-syntax">${p(n[3])}</span>${T(n[4],s,a)}</div>`];const o=t.text.match(/^(\[[^\]]+\]:\s+)(\S+)(\s+"[^"]*")?$/);if(o){const r=o[1],u=o[2],d=o[3]||"";return[`<div class="line"><span class="md-syntax">${p(r)}</span><a href="${p(u)}" target="_blank" rel="noopener noreferrer">${p(u)}</a><span class="md-syntax">${p(d)}</span></div>`]}const e=t.text.match(/^(\s+)/);if(e){const r=e[1],u=t.text.slice(r.length);return[`<div class="line"><span class="indent">${p(r)}</span>${T(u,s,a)}</div>`]}return[`<div class="line">${T(t.text,s,a)}</div>`]}default:return console.warn(`Unknown segment type: "${t.type}"`),[`<div class="line">${T(t.text,s,a)}</div>`]}}function Ne(t){const s=Ce(t),a=_e(t);return X(t).flatMap(o=>z(o,s,a)).join("")}const Oe=3e3;function De(t,s,a){function n(o){try{const e=Me(s(),a),r=new ClipboardItem({"text/plain":e});navigator.clipboard.write([r]).then(()=>je(o,"Link copied!"))}catch(e){console.error("Failed to copy link to clipboard:",e)}}if(document.addEventListener("keydown",o=>{(o.metaKey||o.ctrlKey)&&o.key==="s"&&(o.preventDefault(),n(o.metaKey?"⌘S":"Ctrl+S"))}),"ontouchstart"in window){const o=Be();document.body.appendChild(o);let e;t.addEventListener("touchstart",()=>{o.classList.add("visible"),clearTimeout(e),e=setTimeout(()=>o.classList.remove("visible"),Oe)},{passive:!0}),o.addEventListener("click",r=>{r.preventDefault(),n()})}}async function Me(t,s){const a=await Ie(t,s),n=await le(JSON.stringify({content:t,parent:a})),o=`${window.location.origin}${window.location.pathname}?#doc=${n}`;return new Blob([o],{type:"text/plain"})}async function Ie(t,{sessionParent:s,getOriginalParent:a}){return await B(t)===s?a()??s:s}function Be(){const t=document.createElement("button");return t.type="button",t.className="share-button",t.setAttribute("aria-label","Copy shareable link"),t.innerHTML=`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
  <polyline points="16 6 12 2 8 6"/>
  <line x1="12" y1="2" x2="12" y2="15"/>
</svg>`,t}function je(t,s){document.querySelector(".signal-overlay")?.remove();const a=document.createElement("div");a.className="signal-overlay";const n=t?`<span class="signal-keys">${t}</span>`:"";a.innerHTML=`<div class="signal">${n}<span class="signal-message">${s}</span></div>`,document.body.appendChild(a),a.addEventListener("animationend",o=>{o.target===a&&a.remove()})}const Z=()=>document.body.classList.add("fonts-loaded");document.fonts.ready.then(Z);setTimeout(Z,2e3);async function U(){const t=document.querySelector(".paper");document.querySelector(".logo")?.addEventListener("animationend",e=>e.target.remove(),{once:!0});const{content:s,sessionParent:a,isSharedLink:n}=await ue(),o=Le(t,s,Ne,e=>pe(e,a),{initialCaretPosition:n?0:fe(),onCaretChange:he});De(t,o.getText,{sessionParent:a,getOriginalParent:W}),t.focus(),He(2e3)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",U):U();function He(t){let s;document.addEventListener("mousemove",()=>{document.body.classList.remove("hide-cursor"),clearTimeout(s),s=setTimeout(()=>document.body.classList.add("hide-cursor"),t)},{passive:!0}),document.body.classList.add("hide-cursor")}
