(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(a){if(a.ep)return;a.ep=!0;const t=r(a);fetch(a.href,t)}})();async function J(e){if(e.length===0)return"";const s=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),r=new Uint8Array(await new Response(s).arrayBuffer()),n=Array.from(r,a=>String.fromCodePoint(a)).join("");return btoa(n)}async function pt(e){if(e.length===0)return"";const s=atob(e),r=Uint8Array.from(s,n=>n.charCodeAt(0));try{const n=new Blob([r]).stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(n).text()}catch{return new TextDecoder().decode(r)}}function B(e){return e.replace(/\r\n?/g,`
`)}async function D(e){const s=new TextEncoder().encode(B(e)),r=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(r),n=>n.toString(16).padStart(2,"0")).join("")}const F="#doc=";async function ht(){const e=window.location.hash,s=e.startsWith(F),r=s?await xt(e.substring(F.length)):null;if(yt(),r){const d=B(r.content||""),u=await D(d),f=r.parent??u;return localStorage.clear(),localStorage.setItem("doc",JSON.stringify({content:d,parent:u})),localStorage.setItem("originalParent",f),{content:d,sessionParent:u,originalParent:f,isSharedLink:s}}const n=$t(),a=B(n?.content||""),t=n?.parent??await D(a),o=z();return localStorage.setItem("doc",JSON.stringify({content:a,parent:t})),{content:a,sessionParent:t,originalParent:o,isSharedLink:s}}async function ft(e,s){e===""?(localStorage.setItem("doc",JSON.stringify({content:"",parent:await D("")})),localStorage.removeItem("originalParent")):localStorage.setItem("doc",JSON.stringify({content:e,parent:s}))}function z(){return localStorage.getItem("originalParent")}function mt(){try{const e=localStorage.getItem("caretPosition");return e!==null?parseInt(e,10):0}catch{return 0}}function gt(e){localStorage.setItem("caretPosition",String(e))}function yt(){window.history.replaceState(null,"",window.location.pathname)}async function xt(e){try{const s=decodeURIComponent(e);if(s.startsWith("https://")||s.startsWith("http://"))return await wt(s);const r=await pt(s);return JSON.parse(r)}catch(s){return console.error("Error loading document from URL:",s.message),null}}async function wt(e){const s=await fetch(e);if(!s.ok)throw new Error(`Failed to fetch document: ${s.status} ${s.statusText}`);const r=await s.text();try{const n=JSON.parse(r);if(n.content!==void 0)return n}catch{}return{content:r}}function $t(){const e=localStorage.getItem("doc");if(!e)return null;try{return JSON.parse(e)}catch(s){return console.error("Error parsing saved doc",s),null}}const I=2,bt=/^(\s*(?:>\s*)*)([-*+] (?:\[[ xX]\] )?|\d+\. )?/;function M(e,s){let r=s;for(;r>0&&e[r-1]!==`
`;)r--;return r}function H(e,s){let r=s;for(;r<e.length&&e[r]!==`
`;)r++;return r}function X(e){const s=e.match(bt),r=s[1]||"",n=s[2]||"";return{prefix:r+n,structural:r,marker:n}}function vt(e,s,r){if(!r.match(/^[-=]+\s*$/)||s===0)return!1;const n=M(e,s-1),a=e.slice(n,s-1);if(a===""||a.match(/^\s*(---+|\*\*\*+|___+)\s*$/)||a.match(/^- /))return!1;if(n>0){const t=M(e,n-1);if(e.slice(t,n-1)!=="")return!1}return!0}function St(e,s){if(!s)return e;const r=s.match(/^([-*+] )\[[ xX]\] $/);if(r)return e+r[1]+"[ ] ";const n=s.match(/^(\d+)\. $/);if(n){const a=parseInt(n[1],10)+1;return e+a+". "}return e+s}function Tt(e,s,r){const n=M(e,s),a=H(e,r),t=e.slice(n,a);if(vt(e,n,t))return{text:e.slice(0,s)+`
`+e.slice(r),offset:s+1};const{prefix:o,structural:d,marker:u}=X(t);if(o.length===0)return{text:e.slice(0,s)+`
`+e.slice(r),offset:s+1};const f=t.slice(o.length),x=s<=n+o.length;if(f.trim()===""&&x)return{text:e.slice(0,n)+e.slice(n+o.length),offset:n};const y=St(d,u);return{text:e.slice(0,s)+`
`+y+e.slice(r),offset:s+1+y.length}}function Lt(e,s){const r=M(e,s),n=e.slice(r,H(e,s)),{prefix:a}=X(n),t=s-r,o=" ".repeat(I);return t<=a.length?{text:e.slice(0,r)+o+e.slice(r),offset:s+I}:{text:e.slice(0,s)+o+e.slice(s),offset:s+I}}function Ct(e,s){const r=M(e,s),a=e.slice(r,H(e,s)).match(/^\s*/)[0].length,t=Math.min(a,I);if(t===0)return{text:e,offset:s};const o=e.slice(0,r)+e.slice(r+t),d=Math.max(r,s-t);return{text:o,offset:d}}function kt(e,s,r,n,a={}){let t=s;const o=[],d=[];let u=0,f="",x=-1,w=!1,y=-1;function $(i){e.innerHTML=r(i)}function b(i,c,l){if(c===i){let m=0;const k=Math.min(l,i.childNodes.length);for(let C=0;C<k;C++)m+=i.childNodes[C].textContent.length,C<i.childNodes.length-1&&(m+=1);return m}let h=c;for(;h&&h.parentNode!==i;)h=h.parentNode;if(!h)return 0;let g=0;for(let m=i.firstChild;m&&m!==h;m=m.nextSibling)g+=m.textContent.length+1;try{const m=document.createRange();m.setStart(h,0),m.setEnd(c,l),g+=m.toString().length}catch{}return g}function E(){const i=window.getSelection();return i.rangeCount?b(e,i.focusNode,i.focusOffset):0}function L(){const i=window.getSelection();if(!i.rangeCount)return{start:0,end:0};const c=b(e,i.anchorNode,i.anchorOffset),l=b(e,i.focusNode,i.focusOffset);return{start:Math.min(c,l),end:Math.max(c,l)}}function _(i){const c=document.createTreeWalker(i,NodeFilter.SHOW_TEXT);let l=null;for(;c.nextNode();)l=c.currentNode;return l}function P(i,c){const l=_(c);l?i.collapse(l,l.textContent.length):i.collapse(c,c.childNodes.length)}function N(i){const c=window.getSelection(),l=Array.from(e.children);if(l.length===0){c.collapse(e,0);return}let h=i;for(let g=0;g<l.length;g++){const m=l[g],k=m.textContent.length;if(h<=k){const C=document.createTreeWalker(m,NodeFilter.SHOW_TEXT);for(;C.nextNode();){const q=C.currentNode.textContent.length;if(h<=q){c.collapse(C.currentNode,h);return}h-=q}c.collapse(m,0);return}if(h-=k,g<l.length-1){if(h===0){P(c,m);return}h-=1}}P(c,l[l.length-1])}function j(){const i=window.getSelection();if(!i.rangeCount)return;let c=i.getRangeAt(0).getBoundingClientRect();if(c.top===0&&c.bottom===0&&c.left===0&&c.right===0){const g=i.focusNode,m=g?.nodeType===Node.ELEMENT_NODE?g:g?.parentElement;m&&(c=m.getBoundingClientRect())}if(!c||c.top===0&&c.bottom===0)return;const l=40,h=window.innerHeight;c.bottom>h-l?window.scrollBy({top:c.bottom-h+l,behavior:"smooth"}):c.top<l&&window.scrollBy({top:c.top-l,behavior:"smooth"})}function v(i,c){const l=Date.now(),h=Math.abs(c-x)>1;if(i===f&&!h&&l-u<500&&o.length>0){u=l,x=c;return}o.push({text:t,offset:c}),d.length=0,u=l,f=i,x=c}function Y(){if(o.length===0)return;d.push({text:t,offset:E()});const i=o.pop();t=i.text,$(t),N(i.offset),j(),n(t)}function tt(){if(d.length===0)return;o.push({text:t,offset:E()});const i=d.pop();t=i.text,$(t),N(i.offset),j(),n(t)}function et(i){if(i===0)return 0;let c=i;for(;c>0&&/\s/.test(t[c-1]);)c--;if(c===0)return 0;if(/\w/.test(t[c-1]))for(;c>0&&/\w/.test(t[c-1]);)c--;else for(;c>0&&!/[\s\w]/.test(t[c-1]);)c--;return c}function nt(i){const c=t.length;if(i>=c)return c;let l=i;if(/\w/.test(t[l]))for(;l<c&&/\w/.test(t[l]);)l++;else if(/\s/.test(t[l]))for(;l<c&&/\s/.test(t[l]);)l++;else for(;l<c&&!/[\s\w]/.test(t[l]);)l++;for(;l<c&&/\s/.test(t[l]);)l++;return l}function st(i){if(i===0)return 0;let c=i;for(;c>0&&t[c-1]!==`
`;)c--;return c}function ct(i){const c=t.length;if(i>=c)return c;let l=i;for(;l<c&&t[l]!==`
`;)l++;return l}function A(i){const c=i.length,{start:l,end:h}=L();if(!(l!==h)){v("format",l),t=t.slice(0,l)+i+i+t.slice(l),S(l+c);return}const m=t.slice(l-c,l),k=t.slice(h,h+c);m===i&&k===i?(v("format",l),t=t.slice(0,l-c)+t.slice(l,h)+t.slice(h+c),S(h-c)):(v("format",l),t=t.slice(0,l)+i+t.slice(l,h)+i+t.slice(h),S(h+c+c))}function S(i){$(t),N(i),j(),n(t),a.onCaretChange?.(i)}function O(i,c,l,h){if(c!==l)v(i,c),t=t.slice(0,c)+t.slice(l),S(c);else{const g=h();if(g!==c){v(i,c);const m=Math.min(c,g),k=Math.max(c,g);t=t.slice(0,m)+t.slice(k),S(m)}}}function at(i){if(w||(i.preventDefault(),i.inputType==="insertCompositionText")||i.inputType==="insertFromPaste"||i.inputType==="deleteByCut")return;const{start:c,end:l}=L();switch(i.inputType){case"insertText":{const h=i.data||"";v("insertText",c),t=t.slice(0,c)+h+t.slice(l),S(c+h.length);break}case"insertParagraph":case"insertLineBreak":{v("insertLine",c);const h=Tt(t,c,l);t=h.text,S(h.offset);break}case"deleteContentBackward":O("delete",c,l,()=>Math.max(0,c-1));break;case"deleteContentForward":O("delete",c,l,()=>Math.min(t.length,c+1));break;case"deleteWordBackward":O("deleteWord",c,l,()=>et(c));break;case"deleteWordForward":O("deleteWord",c,l,()=>nt(c));break;case"deleteSoftLineBackward":case"deleteHardLineBackward":O("deleteLine",c,l,()=>st(c));break;case"deleteSoftLineForward":case"deleteHardLineForward":O("deleteLine",c,l,()=>ct(c));break;case"insertReplacementText":{const h=i.getTargetRanges();if(h.length>0){const g=h[0],m=b(e,g.startContainer,g.startOffset),k=b(e,g.endContainer,g.endOffset),C=i.dataTransfer?.getData("text/plain")||i.data||"";v("replace",m),t=t.slice(0,m)+C+t.slice(k),S(m+C.length)}break}}}function ot(){w=!0,y=E()}function rt(){w=!1;const i=E();v("composition",y>=0?y:i),y=-1,t=Array.from(e.children).map(c=>c.textContent).join(`
`),$(t),N(i),n(t)}function it(i){i.preventDefault();const{start:c,end:l}=L();c!==l&&i.clipboardData.setData("text/plain",t.slice(c,l))}function lt(i){i.preventDefault();const{start:c,end:l}=L();c!==l&&(i.clipboardData.setData("text/plain",t.slice(c,l)),v("cut",c),t=t.slice(0,c)+t.slice(l),S(c))}function dt(i){i.preventDefault();const c=B(i.clipboardData.getData("text/plain"));if(!c)return;const{start:l,end:h}=L();v("paste",l),t=t.slice(0,l)+c+t.slice(h),S(l+c.length)}function ut(i){if((i.metaKey||i.ctrlKey)&&i.key==="z"?(i.preventDefault(),i.shiftKey?tt():Y()):(i.metaKey||i.ctrlKey)&&i.key==="b"?(i.preventDefault(),A("**")):(i.metaKey||i.ctrlKey)&&i.key==="i"&&(i.preventDefault(),A("_")),i.key==="Tab"){i.preventDefault();const{start:c,end:l}=L(),h=c!==l;if(i.shiftKey){v("outdent",c);const g=Ct(t,c);t=g.text,S(g.offset)}else if(h)v("indent",c),t=t.slice(0,c)+"  "+t.slice(l),S(c+2);else{v("indent",c);const g=Lt(t,c);t=g.text,S(g.offset)}}}e.addEventListener("keydown",ut),e.addEventListener("beforeinput",at),e.addEventListener("compositionstart",ot),e.addEventListener("compositionend",rt),e.addEventListener("copy",it),e.addEventListener("cut",lt),e.addEventListener("paste",dt),e.addEventListener("blur",()=>{w=!1}),$(t);const R=Math.min(a.initialCaretPosition??0,t.length);if(R>0){N(R);const i=window.getSelection();if(i.rangeCount){const c=i.getRangeAt(0).getBoundingClientRect();if(c&&c.height>0){const l=window.innerHeight/2;window.scrollBy({top:c.top-l})}}}return document.addEventListener("selectionchange",()=>{if(!a.onCaretChange)return;const i=window.getSelection();i.rangeCount&&e.contains(i.focusNode)&&a.onCaretChange(E())}),{getText:()=>t}}function p(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Et(e){const s={},r=e.split(`
`);for(const n of r){const a=n.match(/^\[([^\]]+)\]:\s+(\S+)(?:\s+"([^"]*)")?$/);a&&(s[a[1].toLowerCase()]={url:a[2],title:a[3]||""})}return s}function _t(e){const s={},r=e.split(`
`);for(const n of r){const a=n.match(/^\[\^([^\]]+)\]:\s+(.*)/);a&&(s[a[1].toLowerCase()]=a[2])}return s}function Z(e){const s=e.split(`
`),r=[];let n=0,a=0;if(s[0].match(/^---\s*$/)&&s.length>1){for(let t=1;t<s.length;t++)if(s[t].match(/^\s*---\s*$/)){const o=s.slice(0,t+1).join(`
`);r.push({type:"metadata",text:o,offset:0}),n=o.length+1,a=t+1;break}}for(;a<s.length;){const t=s[a];if(t.match(/^```/)){let o=a+1;for(;o<s.length&&!s[o].match(/^\s*```/);)o++;if(o<s.length){const d=s.slice(a,o+1).join(`
`);r.push({type:"code",text:d,offset:n}),n+=d.length+1,a=o+1;continue}}if(t.match(/^\$\$\s*$/)){let o=a+1;for(;o<s.length&&!s[o].match(/^\s*\$\$/);)o++;if(o<s.length){const d=s.slice(a,o+1).join(`
`);r.push({type:"math",text:d,offset:n}),n+=d.length+1,a=o+1;continue}}if(t.match(/^\|.*\|\s*$/)&&a+1<s.length){const o=s[a+1];if(o.match(/^\|(?:\s*:?-+:?\s*\|)+\s*$/)){const d=u=>u.split("|").length-1;if(d(t)===d(o)){let u=a+2;for(;u<s.length&&s[u].match(/^\|.*\|\s*$/);)u++;const f=s.slice(a,u).join(`
`);r.push({type:"table",text:f,offset:n}),n+=f.length+1,a=u;continue}}}if(t.match(/^\s*>(?:\s|$)/)){let o=a+1;for(;o<s.length&&s[o].match(/^\s*>(?:\s|$)/);)o++;const u=s.slice(a,o).map(y=>{const $=y.match(/^(\s*>)(\s?)(.*)/);return $?{prefix:$[1]+$[2],content:$[3]}:{prefix:"",content:y}}),f=u.map(y=>y.content).join(`
`),x=Z(f);let w=0;for(const y of x){const $=y.text.split(`
`).length,b=u.slice(w,w+$).map(_=>_.prefix),L=y.text.split(`
`).map((_,P)=>b[P]+_).join(`
`);y.blockquote?r.push({type:y.type,text:L,offset:n,blockquote:!0,innerText:y.innerText,prefixes:b.map((_,P)=>_+y.prefixes[P])}):r.push({type:y.type,text:L,offset:n,blockquote:!0,innerText:y.text,prefixes:b}),n+=L.length+1,w+=$}a=o;continue}if(t.match(/^#{1,6}[ \t]+.+$/)){r.push({type:"heading",text:t,offset:n}),n+=t.length+1,a++;continue}if(t!==""&&!t.match(/^\s*(---+|\*\*\*+|___+)\s*$/)&&!t.match(/^- /)&&(a===0||s[a-1]==="")&&a+1<s.length){const o=s[a+1];if(o.match(/^=+\s*$/)||o.match(/^-+\s*$/)){const d=t+`
`+o;r.push({type:"setext",text:d,offset:n}),n+=d.length+1,a+=2;continue}}if(t.match(/^\s*(---+|\*\*\*+|___+)\s*$/)){r.push({type:"hr",text:t,offset:n}),n+=t.length+1,a++;continue}if(t.match(/^(?: {4}|\t)/)&&!t.match(/^\s*[*\-+] /)&&!t.match(/^\s*\d+\. /)&&!t.match(/^\s*>(?:\s|$)/)){let o=a+1;for(;o<s.length&&s[o].match(/^(?: {4}|\t)/)&&!s[o].match(/^\s*[*\-+] /)&&!s[o].match(/^\s*\d+\. /)&&!s[o].match(/^\s*>(?:\s|$)/);)o++;const d=s.slice(a,o).join(`
`);r.push({type:"indented-code",text:d,offset:n}),n+=d.length+1,a=o;continue}if(t.match(/^\s*[*\-+] /)||t.match(/^\s*\d+\. /)||t.match(/^: /)){let o=a+1;for(;o<s.length&&(s[o].match(/^\s*[*\-+] /)||s[o].match(/^\s*\d+\. /)||s[o].match(/^: /));)o++;const d=s.slice(a,o).join(`
`);r.push({type:"list",text:d,offset:n}),n+=d.length+1,a=o;continue}r.push({type:"line",text:t,offset:n}),n+=t.length+1,a++}return r}function T(e,s,r){let n=e;const a=[],t=d=>{const u=`PROTECTED${a.length}`;return a.push(d),u};n=n.replace(/\\([\\`*_{}\[\]()#+\-.!~^|$])/g,(d,u)=>t(`<span class="md-syntax">\\</span>${p(u)}`)),n=n.replace(new RegExp("(?<!`)`(?!`)([^`\\n]+?)`(?!`)","g"),(d,u)=>t(`<code><span class="md-syntax">\`</span>${p(u)}<span class="md-syntax">\`</span></code>`)),n=n.replace(new RegExp("(?<!\\$)\\$(?!\\$)([^\\$\\n]+?)\\$(?!\\$)","g"),(d,u)=>t(`<code class="math"><span class="md-syntax">$</span>${p(u)}<span class="md-syntax">$</span></code>`)),n=n.replace(/<!--([\s\S]*?)-->/g,(d,u)=>t(`<span class="comment">&lt;!--${p(u)}--&gt;</span>`)),n=n.replace(/<(https?:\/\/[^>\s]+)>/g,(d,u)=>t(`<span class="md-syntax">&lt;</span><span class="link">${p(u)}</span><span class="md-syntax">&gt;</span>`)),n=n.replace(/<([^>\s]+@[^>\s]+\.[^>\s]+)>/g,(d,u)=>t(`<span class="md-syntax">&lt;</span><span class="link">${p(u)}</span><span class="md-syntax">&gt;</span>`)),n=n.replace(/<\/?[a-zA-Z][a-zA-Z0-9-]*(?:[ \t]+[^>]*)?\/?>/g,d=>t(`<code class="md-syntax">${p(d)}</code>`)),n=n.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(d,u,f)=>t(`<span class="md-syntax">![</span>${p(u)}<span class="md-syntax">](</span><span class="link">${p(f)}</span><span class="md-syntax">)</span>`)),n=n.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(d,u,f)=>t('<span class="md-syntax">[</span>')+u+t(`<span class="md-syntax">](</span><span class="link">${p(f)}</span><span class="md-syntax">)</span>`)),n=n.replace(/!\[([^\]]*)\]\[([^\]]*)\]/g,(d,u,f)=>{const x=(f||u).toLowerCase();return s[x]?t(`<span class="md-syntax">![</span>${p(u)}<span class="md-syntax">][</span><span class="link">${p(f)}</span><span class="md-syntax">]</span>`):d}),n=n.replace(/\[([^\]]+)\]\[([^\]]*)\]/g,(d,u,f)=>{const x=(f||u).toLowerCase();return s[x]?t('<span class="md-syntax">[</span>')+u+t(`<span class="md-syntax">][</span><span class="link">${p(f)}</span><span class="md-syntax">]</span>`):d}),n=n.replace(/\[\^([^\]]+)\]/g,(d,u)=>{const f=r[u.toLowerCase()];return f?t('<span class="md-syntax">[^</span>')+t(`<span class="link" title="${p(f)}">${p(u)}</span>`)+t('<span class="md-syntax">]</span>'):t('<span class="md-syntax">[^</span>')+u+t('<span class="md-syntax">]</span>')}),n=n.replace(/https?:\/\/[^\s<>]*[^\s<>.,;:!?"')\]]/g,d=>t(`<span class="link">${p(d)}</span>`)),n=n.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,d=>t(`<span class="link">${p(d)}</span>`)),n=p(n);const o=d=>`<span class="md-syntax">${d}</span>`;for(n=n.replace(/\*\*\*([^\s\*](?:[^\*\n]*?[^\s\*])?)\*\*\*/g,(d,u)=>t(`<b><em>${o("***")}`)+u+t(`${o("***")}</em></b>`)),n=n.replace(/\*\*([^\s\*](?:[^\*\n]*?[^\s\*])?)\*\*/g,(d,u)=>`<b>${o("**")}${u}${o("**")}</b>`),n=n.replace(/__([^\s_](?:[^_\n]*?[^\s_])?)__/g,(d,u)=>`<b>${o("__")}${u}${o("__")}</b>`),n=n.replace(/~~([^\s~](?:[^~\n]*?[^\s~])?)~~/g,(d,u)=>`<s>${o("~~")}${u}${o("~~")}</s>`),n=n.replace(/\^([^\s^](?:[^^\n]*?[^\s^])?)\^/g,(d,u)=>`<sup>${o("^")}${u}${o("^")}</sup>`),n=n.replace(new RegExp("(?<!~)~(?!~)([^\\s~](?:[^~\\n]*?[^\\s~])?)~(?!~)","g"),(d,u)=>`<sub>${o("~")}${u}${o("~")}</sub>`),n=n.replace(new RegExp("(?<!\\*)\\*(?!\\*)([^\\s\\*](?:[^\\*\\n]*?[^\\s\\*])?)\\*(?!\\*)","g"),(d,u)=>`<em>${o("*")}${u}${o("*")}</em>`),n=n.replace(/_([^\s_](?:[^_\n]*?[^\s_])?)_/g,(d,u)=>`<em>${o("_")}${u}${o("_")}</em>`);/\uE000PROTECTED\d+\uE001/.test(n);)n=n.replace(/\uE000PROTECTED(\d+)\uE001/g,(d,u)=>a[parseInt(u,10)]);return n}function Pt(e){let s="",r=e;for(;r.length>0;){const n=r.match(/^(\s*)(>)(\s?)/);if(!n){s+=p(r);break}const a=n[1],t=n[2],o=n[3];a&&(s+=`<span class="indent">${p(a)}</span>`),s+=`<span class="md-syntax bq-prefix">${p(t)}${o}</span>`,r=r.slice(n[0].length)}return s}function Ot(e){return/^<\w+[^>]*\sclass="[^"]*bq/.test(e)?e:/^<\w+[^>]*\sclass="/.test(e)?e.replace(/^(<\w+[^>]*\sclass="[^"]*)(")/,"$1 bq$2"):e.replace(/^(<\w+)/,'$1 class="bq"')}function Nt(e,s){const n=e.split(`
`).map((a,t)=>{const o=s[t];if(!o)return a;const d=Pt(o),u=a.match(/^(<(?:pre|code|div|h[1-6])[^>]*>)*/),f=u?u[0].length:0,x=a.replace(/<br>/g,"");return x.slice(0,f)+d+x.slice(f)}).join(`
`);return Ot(n)}function K(e,s,r){const n=r?` class="${r}"`:"",a=e.match(s);return a?`<pre><code${n}><span class="md-syntax">${p(a[1])}</span>
${p(a[2])}
<span class="md-syntax">${p(a[3])}</span></code></pre>`:`<pre><code${n}>${p(e)}</code></pre>`}function V(e,s,r){if(e.blockquote){const n={type:e.type,text:e.innerText},a=V(n,s,r);let t=0;const o=[];for(const d of a){const u=(d.match(/\n/g)||[]).length+1,f=e.prefixes.slice(t,t+u);o.push(Nt(d,f)),t+=u}return o}switch(e.type){case"metadata":{const n=e.text.split(`
`),a=`<span class="md-syntax">${p(n[0])}</span>`,t=`<span class="md-syntax">${p(n[n.length-1])}</span>`,o=n.slice(1,-1);return o.length>0?[`<pre><code>${a}
${o.map(d=>p(d)).join(`
`)}
${t}</code></pre>`]:[`<pre><code>${a}
${t}</code></pre>`]}case"code":return[K(e.text,/^(```[^\n]*)\n([\s\S]*?)\n(\s*```)$/)];case"indented-code":return[`<pre><code>${p(e.text)}</code></pre>`];case"table":return[`<pre><code>${e.text.split(`
`).map((t,o)=>{const d=p(t);return o===1?`<span class="md-syntax">${d}</span>`:d.replace(/\|/g,'<span class="md-syntax">|</span>')}).join(`
`)}</code></pre>`];case"math":return[K(e.text,/^(\$\$)\n([\s\S]*?)\n(\s*\$\$)$/,"math")];case"heading":{const n=e.text.match(/^(#{1,6}[ \t]+)(.*)/),a=n[1].trim().length;return[`<h${a}><span class="md-syntax">${p(n[1])}</span>${T(n[2],s,r)}</h${a}>`]}case"setext":{const n=e.text.indexOf(`
`),a=e.text.slice(0,n),t=e.text.slice(n+1),o=t.trimStart()[0]==="="?1:2;return[`<h${o}>${T(a,s,r)}
<span class="md-rule md-syntax">${p(t)}</span></h${o}>`]}case"hr":return[`<div class="md-rule md-syntax">${p(e.text)}</div>`];case"list":return[`<div class="list">${e.text.split(`
`).map(t=>{const o=t.match(/^(\s*)([*\-+] )/);if(o){const f=o[1],x=o[2],w=t.slice(f.length+x.length),y=f?`<span class="indent">${p(f)}</span>`:"",$=w.match(/^(\[[ xX]\] )/);if($){const b=$[1],E=w.slice(b.length),_=b[1]!==" "?`<span class="task-done">${T(E,s,r)}</span>`:T(E,s,r);return`${y}<span class="md-syntax">${p(x)}</span><span class="md-checkbox">${p(b)}</span>${_}`}return`${y}<span class="md-syntax">${p(x)}</span>${T(w,s,r)}`}const d=t.match(/^(\s*)(\d+\. )/);if(d){const f=d[1],x=d[2],w=t.slice(f.length+x.length);return`${f?`<span class="indent">${p(f)}</span>`:""}<span class="md-syntax">${p(x)}</span>${T(w,s,r)}`}const u=t.match(/^(: )/);if(u){const f=u[1],x=t.slice(f.length);return`<span class="md-syntax">${p(f)}</span>${T(x,s,r)}`}return T(t,s,r)}).join(`
`)}</div>`];case"line":{if(e.text==="")return['<div class="line"><br></div>'];const n=e.text.match(/^(\*\[)([^\]]+)(\]:\s)(.*)/)||e.text.match(/^(\[\^)([^\]]+)(\]:\s)(.*)/);if(n)return[`<div class="line"><span class="md-syntax">${p(n[1])}</span>${p(n[2])}<span class="md-syntax">${p(n[3])}</span>${T(n[4],s,r)}</div>`];const a=e.text.match(/^(\[[^\]]+\]:\s+)(\S+)(\s+"[^"]*")?$/);if(a){const o=a[1],d=a[2],u=a[3]||"";return[`<div class="line"><span class="md-syntax">${p(o)}</span><span class="link">${p(d)}</span><span class="md-syntax">${p(u)}</span></div>`]}const t=e.text.match(/^(\s+)/);if(t){const o=t[1],d=e.text.slice(o.length);return[`<div class="line"><span class="indent">${p(o)}</span>${T(d,s,r)}</div>`]}return[`<div class="line">${T(e.text,s,r)}</div>`]}default:return console.warn(`Unknown segment type: "${e.type}"`),[`<div class="line">${T(e.text,s,r)}</div>`]}}function Dt(e){const s=Et(e),r=_t(e);return Z(e).flatMap(a=>V(a,s,r)).join("")}const Mt=3e3;function It(e,s,r){function n(t){try{const o=Bt(s(),r),d=new ClipboardItem({"text/plain":o});navigator.clipboard.write([d]).then(()=>U(t,"Link copied!"))}catch(o){console.error("Failed to copy link to clipboard:",o)}}function a(t){try{const o=jt(s(),r),d=new ClipboardItem({"text/plain":o});navigator.clipboard.write([d]).then(()=>U(t,"Markdown link copied!"))}catch(o){console.error("Failed to copy markdown link to clipboard:",o)}}if(document.addEventListener("keydown",t=>{(t.metaKey||t.ctrlKey)&&t.key.toLowerCase()==="s"&&(t.preventDefault(),t.shiftKey?a(t.metaKey?"⇧⌘S":"Ctrl+Shift+S"):n(t.metaKey?"⌘S":"Ctrl+S"))}),"ontouchstart"in window){const t=Ht();document.body.appendChild(t);let o;e.addEventListener("touchstart",()=>{t.classList.add("visible"),clearTimeout(o),o=setTimeout(()=>t.classList.remove("visible"),Mt)},{passive:!0}),t.addEventListener("click",d=>{d.preventDefault(),n()})}}async function Bt(e,s){const r=await G(e,s),n=await J(JSON.stringify({content:e,parent:r})),a=`${window.location.origin}${window.location.pathname}?#doc=${n}`;return new Blob([a],{type:"text/plain"})}async function jt(e,s){const r=await G(e,s),n=await J(JSON.stringify({content:e,parent:r})),a=`${window.location.origin}${window.location.pathname}?#doc=${n}`,o=`[${await D(e)}](${a})`;return new Blob([o],{type:"text/plain"})}async function G(e,{sessionParent:s,getOriginalParent:r}){return await D(e)===s?r()??s:s}function Ht(){const e=document.createElement("button");return e.type="button",e.className="share-button",e.setAttribute("aria-label","Copy shareable link"),e.innerHTML=`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
  <polyline points="16 6 12 2 8 6"/>
  <line x1="12" y1="2" x2="12" y2="15"/>
</svg>`,e}function U(e,s){document.querySelector(".signal-overlay")?.remove();const r=document.createElement("div");r.className="signal-overlay";const n=e?`<span class="signal-keys">${e}</span>`:"";r.innerHTML=`<div class="signal">${n}<span class="signal-message">${s}</span></div>`,document.body.appendChild(r),r.addEventListener("animationend",a=>{a.target===r&&r.remove()})}const Q=()=>document.body.classList.add("fonts-loaded");document.fonts.ready.then(Q);setTimeout(Q,2e3);async function W(){const e=document.querySelector(".paper");document.querySelector(".logo")?.addEventListener("animationend",t=>t.target.remove(),{once:!0});const{content:s,sessionParent:r,isSharedLink:n}=await ht(),a=kt(e,s,Dt,t=>ft(t,r),{initialCaretPosition:n?0:mt(),onCaretChange:gt});It(e,a.getText,{sessionParent:r,getOriginalParent:z}),e.focus(),At(2e3)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",W):W();function At(e){let s;document.addEventListener("mousemove",()=>{document.body.classList.remove("hide-cursor"),clearTimeout(s),s=setTimeout(()=>document.body.classList.add("hide-cursor"),e)},{passive:!0}),document.body.classList.add("hide-cursor")}
